// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model organizations {
    id                  String @id @default(cuid())
    name                String @unique
    active              Boolean @default(true)
    org                 String
    creator             String
    created             DateTime @default(now())
    updated             DateTime @default(now()) @updatedAt
}

model temp {
    userId              String?
    username            String
    password            String?
    nonce               String @unique
    created             DateTime @default(now())
}

model users {
    id                  String @id @default(cuid())
    username            String
    password            String
    active              Boolean @default(true)
    user                String? @unique
    userRef             users? @relation("Owner", fields: [user], references: [id])
    owner               users? @relation("Owner")
    org                 String
    creator             String
    created             DateTime @default(now())
    updated             DateTime @default(now()) @updatedAt

    roles               roles[]

    @@unique([username, org])
}

model roles {
    id                  String @id @default(cuid())
    name                String @unique
    public              Boolean @default(false)
    default             Boolean @default(false)
    admin               Boolean @default(false)
    org                 String
    creator             String
    created             DateTime @default(now())
    updated             DateTime @default(now()) @updatedAt

    users               users[]
    permissions         permissions[]
}

model permissions {
    id                  String @id @default(cuid())
    roleRef             roles @relation(fields: [role], references: [name], onDelete: Cascade)
    role                String
    resource            String
    action              String
    attributes          String @default("*")
    org                 String
    creator             String
    created             DateTime @default(now())
    updated             DateTime @default(now()) @updatedAt

    @@unique([role, resource, action, attributes])
}

model litestream_lock {
    id                  Int @id

    @@map("_litestream_lock")
}

model litestream_seq {
    id                  Int @id @default(autoincrement())
    seq                 Int?

    @@map("_litestream_seq")
}
